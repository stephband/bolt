<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="author" content="" />
	<meta name="description" content="" />
	
	<title>Bolt</title>
	
	<script>document.documentElement.className = 'js';</script>
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
	<!-- Force latest IE rendering engine & Chrome Frame -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<!-- Make IE recognise HTML5 elements for styling -->
	<!--[if lte IE 8]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<noscript>
		<strong>Warning!</strong>
		Your browser does not support HTML5 so some elements on this page are simulated using JScript. Unfortunately your browser has JScript disabled. Please enable it in order to display this page.
	</noscript>
	<![endif]-->
	<!-- Disable image toolbar in IE6 -->
	<!--[if lte IE 6]><meta http-equiv="imagetoolbar" content="no" /><![endif]-->
	
	<link rel="icon" type="image/png" href="images/favicon.png" />
	<link rel="apple-touch-icon" href="/apple-touch-icon.png" />
	
	<link rel="stylesheet" href="css/bolt.normalise.css" />
	<link rel="stylesheet" href="css/bolt.typography.css" />
	<link rel="stylesheet" href="css/bolt.typography.15_24.css" />
	<link rel="stylesheet" href="css/bolt.classes.css" />
	<link rel="stylesheet" href="css/bolt.forms.css" />
	<link rel="stylesheet" href="css/bolt.grid.css" />
	<link rel="stylesheet" href="css/bolt.theme.css" />
	<!--[if (lt IE 9)&(!IEMobile)]>
	<link rel="stylesheet" href="css/bolt.layout.32em.css" media="all" />
	<link rel="stylesheet" href="css/bolt.layout.48em.css" media="all" />
	<![endif]-->
	<!--[if lte IE 8]><link rel="stylesheet" href="css/bolt.ie.css" /><![endif]-->
	<!--[if IE 8]><link rel="stylesheet" href="css/bolt.ie8.css" /><![endif]-->
	<!--[if IE 7]><link rel="stylesheet" href="css/bolt.ie7.css" /><![endif]-->
	<!--[if IE 6]><link rel="stylesheet" href="css/bolt.ie6.css" /><![endif]-->
	<!--link rel="stylesheet" href="css/bolt.debug.css" /-->

	<style>
		body {
			padding-top: 1.25rem;
		}

		.site-wrap {
			width: 88.8888%
		}

		hr {
			margin-top: 1.25rem;
			border-color: #999999;
		}

		style {
			font-family: 'Fira Mono', 'Andale Mono', Courier, monospace;
			font-size: 0.75rem;
			line-height: 1.25em;
			letter-spacing: -0.04375em;
			white-space: pre;
		}

		style.wrap {
			padding-left: 1.1875rem;
			padding-right: 1.25rem;
			color: #eeeeee;
			background-color: #666666;
			border-left: 1px solid #808080;
		}

		.form-wrap {
			margin-top: 2.5rem;
		}

		code {
			white-space: nowrap;
		}

		pre {
			white-space: pre;
		}

		label {
			font-weight: 700;
		}

		label > small {
			font-weight: normal;
		}

		.grey-block {
			margin-top: 2.5rem;
			padding-top: 1.875rem;
			padding-bottom: 5rem;
			background-color: #666666;
		}
	</style>
</head>

<body>

<div class="wrap grid-2/3 grid-left-1/9">
	<h1>bolt.grid.css</h1>

	<p>Generate a responsive grid for Bolt.</p>

	<div class="grid-wrap wrap">
		<div class="grid-block block grid-1/2">
			<p>
			Enter the <b>breakpoints</b> in pixels.
			You may enter any number of breakpoints separated by spaces.
			They get converted to media queries in <code>em</code>. For example, '<code>480&nbsp;960</code>' would&nbsp;generate:
			</p>
			<pre style="width: 120%; font-size: 0.875rem;">@media all and (min-width: 30em) {&hellip;}
@media all and (min-width: 60em) {&hellip;}</pre>
		</div
		><div class="grid-block block grid-1/4">
		<p>
		Grid columns are created from <code>1</code> up to <b>max divisions</b>.
		For example, if max divisions is <code>8</code> or&nbsp;over CSS is generated for:</p>
		<pre style="width: 120%; font-size: 0.875rem;">class="grid-5/8"</pre>
		</div
		><div class="grid-block block grid-1/4">
		The <b>gutter</b> is the fixed space between grid divisions in&nbsp;pixels.
		It gets converted to&nbsp;<code>rem</code>.
		</div>
	</div>


	<div class="form-wrap wrap">
		<div class="block grid-3/4 grid-left-1/4">
			<div class="grid-block block grid-1/3">
				<label for="breakpoints-input">breakpoints <small><i>px</i></small></label>
				<input name="breakpoints" value="" id="breakpoints-input" placeholder="none"/>
			</div
			><div class="grid-block block grid-1/3">
				<label>max devisions</label>
				<input type="number" min="2" max="32" step="1" name="max" value="12" id="max-input"/>
			</div
			><div class="grid-block block grid-1/3">
				<label for="gutter-input">gutter <small><i>px</i></small></label>
				<input name="gutter" value="" id="gutter-input" placeholder="20"/>
			</div
			>
		</div>
	</div>
</div>

<div class="grey-block block">
	<style id="output" class="wrap grid-7/9"></style>
</div>

<script>
	(function() {
		"use strict";
		
		var output = document.getElementById('output');

		function remove(node) {
			node.parentNode && node.parentNode.removeChild(node);
		}

		function insertBefore(target, node) {
			target.parentNode && target.parentNode.insertBefore(node, target);
		}

		function insertAfter(target, node) {
			target.parentNode && target.parentNode.insertBefore(node, target.nextSibling);
		}

		function reducable(n, d) {
			// Is the fraction n/d reduceable?
			if (d === 1) { return false; }

			var f = 1;

			while (f++ < n) {
				if (n / f % 1 === 0 &&
				    d / f % 1 === 0) {
					return true;
				}
			}

			return false;
		}

		function pad(string, length, character) {
			// Add character to string until strength length is length
			var l = string.length;
			var s = '';

			while (l++ < length) {
				s += character;
			}

			return string + s;
		}

/* 360, 480, 540, 600, 720, 800, 840, 960, 1080, 1200, 1320, 1440 */
		function render(breakpoints, gutter, max) {
			var node = document.createElement('style');
			var text = '';

			breakpoints = breakpoints ? [0].concat(breakpoints) : [0];
			gutter = gutter ? (gutter / 16) : 1.25;
			max = max || 12;

			console.log(breakpoints, gutter);

			text += '.grid-wrap,\n.grid-index {';
			text += '\n    margin: -' + (gutter / 2).toFixed(4) + 'rem;';
			text += '\n}\n\n';
			text += '.grid-wrap > .block,\n.grid-index > li,\n.grid-index > li:first-child {';
			text += '\n    margin: ' + (gutter / 2).toFixed(4) + 'rem;';
			text += '\n}\n\n';
			text += '.grid-block {';
			text += '\n    margin-left: ' + gutter.toFixed(4) + 'rem;';
			text += '\n}\n\n';

			breakpoints.forEach(function(b) {
				if (b > 0) {
					text += '@media all and (min-width: ' + (b / 16) + 'em) {\n';
					text += '    /* ' + b + 'px */\n';
				}

				// Render free-standing grid blocks
				var d = 0;
				var n = 0;

				while (d++ < max) {

					n = 0;
					while (++n < d) {
						if (reducable(n, d)) { continue; }

						//text += n + '/' + d + '\n';
						text += (b > 0 ? '    ' : '') + '.grid';
						text += b > 0 ? '-' + b : '';
						text += '-' +  pad(n + '\\/' + d, 6, ' ');
						text += ' { width: calc(' + (100 * n / d).toFixed(4) + '% - ' + (gutter - gutter * n / d).toFixed(4) + 'rem); }';
						text += '\n';
					}
				}

				// Render free-standing grid margins
				var d = 0;
				var n = 0;
				var className, definition;

				while (d++ < max) {
					n = 0;
					while (++n < d) {
						if (reducable(n, d)) { continue; }

						className = '.grid';
						className += b > 0 ? '-' + b : '';
						className += '-left-' +  pad(n + '\\/' + d, 6, ' ');

						text += (b > 0 ? '    ' : '');
						text += className + ' {';
						text += ' margin-left: calc(' + (100 * n / d).toFixed(4) + '% + ' + (gutter * n / d).toFixed(4) + 'rem);';
						text += ' }\n';
					}
				}

				// Render wrapped or indexed grid blocks
				d = 0;
				n = 0;

				while (d++ < max) {
					n = 0;
					while (++n < d) {
						if (reducable(n, d)) { continue; }

						className = '.grid';
						className += b > 0 ? '-' + b : '';
						className += '-' +  pad(n + '\\/' + d, 6, ' ');

						definition = '{ width: calc(' + (100 * n / d).toFixed(4) + '% - ' + gutter + 'rem); }';

						//text += n + '/' + d + '\n';
						text += (b > 0 ? '    ' : '');
						text += '.grid-wrap > ' + className + ', ';
						text += '.grid-index' + className + ' > li ' + definition + '\n';
					}
				}

				d = 0;
				n = 0;
				definition = '';

				while (d++ < max) {
					n = 0;
					while (++n < d) {
						if (reducable(n, d)) { continue; }

						className = '.grid';
						className += b > 0 ? '-' + b : '';
						className += '-left-' +  pad(n + '\\/' + d, 6, ' ');

						definition = '{ margin-left: calc(' + (100 * n / d).toFixed(4) + '% + ' + (gutter / 2).toFixed(4) + 'rem); }';

						text += (b > 0 ? '    ' : '');
						text += '.grid-wrap > ' + className + ', ';
						text += '.grid-index' + className + ' > li ' + definition + '\n';
					}
				}

				if (b > 0) {
					text += '}\n';
				}

				text += '\n';
			});

			node.setAttribute('class', 'wrap grid-7/9');
			node.textContent = text;

			insertBefore(output, node);
			remove(output);
			output = node;
		}

		var model = {
			breakpoints: []
		};

		function change(e) {
			var variable = e.target.name;
			var value;

			if (variable === 'breakpoints') {
				value = e.target.value ? e.target.value.split(' ') : [720];
				console.log(value);
			}
			else if (variable === 'gutter') {
				value = parseFloat(e.target.value);
			}
			else if (variable === 'max') {
				value = parseInt(e.target.value, 10);
			}
			else {
				return;
			}

			model[variable] = value;
			render(model.breakpoints, model.gutter, model.max);
		}

		document.addEventListener('change', change);
		render(model.breakpoints, model.gutter, model.max);
	})();
</script>
</body>
</html>