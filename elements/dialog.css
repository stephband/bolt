
/*
MDN dialog documentation:
https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dialog
*/

/*
Backdrop
Non-modal dialogs do not get a ::backdrop, so if we want want one, and we
most certainly do, we must implement our own. */

body:has(dialog[mode="overlay"])::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;

    opacity: 0;
    visibility: hidden;
    z-index: 1000;

    background-color: rgba(0,0,0,0.4);
    -webkit-backdrop-filter: blur(0.5rem);
            backdrop-filter: blur(0.5rem);
}

body:has(dialog[mode="overlay"])::after,
body:has(dialog[mode="overlay"][open].closing)::after {
    opacity: 0;
    visibility: hidden;
    transition:
        opacity 0.9s linear,
        visibility 0.9s linear;
}

body:has(dialog[mode="overlay"][open])::after {
    opacity: 1;
    visibility: visible;
    transition:
        opacity 0.3s linear,
        visibility 0.3s linear;
}


/* Dialog */

dialog {
    /* Dialogs are display none by default which makes transitions and
       animations to display anything nigh-on impossible */
    display: block;
    position: fixed;

    /* Vertical position center */
    top: 50%;
    max-height: calc(100vh - 2rem);

    /* Override any margins added by text classes or their ilk */
    margin: 0 auto auto;
    max-width: calc(100vw - 2rem);

    /* Zero out browser default border */
    border-width: 0;

    /* Non-modal dialogs do not automatically appear in the top-layer */
    z-index: 1001;
}

dialog,
dialog[open].closing {
    opacity: 0;
    visibility: hidden;
    transform: translate3d(0, calc(1rem - 50%), 0);
    transition:
        opacity 0.9s linear,
        visibility 0.9s linear,
        transform 0.9s ease-out;
}

dialog[open] {
    opacity: 1;
    visibility: visible;
    transform: translate3d(0, -50%, 0);
    transition:
        opacity 0.3s linear,
        visibility 0.3s linear,
        transform 0.3s ease-out;
}

dialog:focus-visible {
    /* Rid ourselves of focus ring on dialog (defined in focus.css).
       TODO: Review this. Maybe a bad idea? */
    box-shadow: none !important;
    border-color: var(--focus-fg) !important;
}


/* Standard backdrop for modal dialogs. We use animation rather than transition
   because it has implicit handling of display none. */

@keyframes backdrop-fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}

@keyframes backdrop-fadeout {
    from { opacity: 1; }
    to   { opacity: 0; }
}

dialog::backdrop {
    background-color: rgba(0,0,0,0.4);
    -webkit-backdrop-filter: blur(0.5rem);
            backdrop-filter: blur(0.5rem);
}

dialog::backdrop,
dialog[open].closing::backdrop {
    opacity: 0;
    animation: backdrop-fadeout 0.6s ease-in forwards;
}

dialog[open]::backdrop {
    opacity: 1;
    animation: backdrop-fadein 0.6s ease-out forwards;
}


/* Content */

dialog > img,
dialog > svg,
dialog > video,
dialog > canvas,
dialog > object,
dialog > embed,
dialog > iframe {
    /* Don't allow media to break out of container bounds. */
    max-width: 100%;
    object-fit: contain;
    object-position: 50% 50%;
}

dialog > img,
dialog > svg,
dialog > video,
dialog > canvas {
    /* Allow images to rescale freely. */
    height: auto;
    max-height: 100%;
}

dialog > .thumb {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
}
